   ecryptfs: Bugfix for error related to ecryptfs_hash_buckets
   
   The function ecryptfs_uid_hash wrongly assumes that the
   second parameter to hash_long() is the number of hash
   buckets instead of the number of hash bits.
   This patch fixes that and renames the variable
   ecryptfs_hash_buckets to ecryptfs_hash_bits to make it
   clearer.
   
   Fixes: CVE-2010-2492
   
   Signed-off-by: Andre Osterhues <aosterhues@escrypt.com>
   Signed-off-by: Tyler Hicks <tyhicks@linux.vnet.ibm.com>
   Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

static struct hlist_head *ecryptfs_daemon_hash;
struct mutex ecryptfs_daemon_hash_mux;
static int ecryptfs_hash_buckets;
#define ecryptfs_uid_hash(uid) \
        hash_long((unsigned long)uid, ecryptfs_hash_buckets)

static u32 ecryptfs_msg_counter;
static struct ecryptfs_msg_ctx *ecryptfs_msg_ctx_arr;
	}
	mutex_init(&ecryptfs_daemon_hash_mux);
	mutex_lock(&ecryptfs_daemon_hash_mux);
	ecryptfs_hash_buckets = 1;
	while (ecryptfs_number_of_users >> ecryptfs_hash_buckets)
		ecryptfs_hash_buckets++;
	ecryptfs_daemon_hash = kmalloc((sizeof(struct hlist_head)
					* ecryptfs_hash_buckets), GFP_KERNEL);
	if (!ecryptfs_daemon_hash) {
		rc = -ENOMEM;
		printk(KERN_ERR "%s: Failed to allocate memory\n", __func__);
		mutex_unlock(&ecryptfs_daemon_hash_mux);
		goto out;
	}
	for (i = 0; i < ecryptfs_hash_buckets; i++)
		INIT_HLIST_HEAD(&ecryptfs_daemon_hash[i]);
	mutex_unlock(&ecryptfs_daemon_hash_mux);
	ecryptfs_msg_ctx_arr = kmalloc((sizeof(struct ecryptfs_msg_ctx)
		int i;

		mutex_lock(&ecryptfs_daemon_hash_mux);
		for (i = 0; i < ecryptfs_hash_buckets; i++) {
			int rc;

			hlist_for_each_entry(daemon, elem,
