   KVM: x86: Catch potential overrun in MCE setup
   
   We only allocate memory for 32 MCE banks (KVM_MAX_MCE_BANKS) but we
   allow user space to fill up to 255 on setup (mcg_cap & 0xff), corrupting
   kernel memory. Catch these overflows.
   
   Signed-off-by: Jan Kiszka <jan.kiszka@siemens.com>
   Signed-off-by: Marcelo Tosatti <mtosatti@redhat.com>
	unsigned bank_num = mcg_cap & 0xff, bank;

	r = -EINVAL;
	if (!bank_num)
		goto out;
	if (mcg_cap & ~(KVM_MCE_CAP_SUPPORTED | 0xff | 0xff0000))
		goto out;
